# 内联缓存


## 概述

### 定义

内联缓存的目的是通过在调用点直接记住先前方法查找的结果来加快运行时方法绑定

### hotspot 实现

hotspot 使用 单态内联缓存

Java 虚拟机所采用的单态内联缓存将纪录调用者的动态类型，以及它所对应的目标方法。
当碰到新的调用者时，如果其动态类型与缓存中的类型匹配，则直接调用缓存的目标方法。

否则，Java 虚拟机将该内联缓存劣化为超多态内联缓存，在今后的执行过程中直接使用方法表进行动态绑定。

### 为什么要动态绑定? 不能在编译器知道么?

示例如下:  a 的类型在编译器不可知

```
A a = null;
int i = 随机数;
if(i 是奇数){
     a = new B();
}else{
    a = new C();
}
a.fun();
```

另外的例子: 使用接口传参, 只有在运行时才知道类型

## todo

1. 了解下 C++ 多态的实现
2. 

## 参考

- https://en.wikipedia.org/wiki/Inline_caching
- https://time.geekbang.org/column/article/12098

